{"paragraphs":[{"text":"%md\n# This Project aims to explore the `u.user` file from the Movielnes 100k Dataset.","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>This Project aims to explore the <code>u.user</code> file from the Movielnes 100k Dataset.</h1>\n"}]},"apps":[],"jobName":"paragraph_1750128128461_-2151482","id":"20250601-074543_2144772667","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:13696"},{"text":"%md\n## Download the file to a local temp folder","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Download the file to a local temp folder</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128463_-1381984","id":"20250601-095933_900818063","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13697"},{"text":"%sh\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.user -O /tmp/u.user\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.data -O /tmp/u.data\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.item -O /tmp/u.item\necho \"Downloaded ml-100k dataset!\"","user":"anonymous","dateUpdated":"2025-06-17T02:48:43+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2025-06-17 02:48:45--  http://media.sundog-soft.com/hadoop/ml-100k/u.user\nResolving media.sundog-soft.com (media.sundog-soft.com)... 3.5.27.119, 52.217.131.137, 3.5.25.28, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|3.5.27.119|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22628 (22K) [text/plain]\nSaving to: ‘/tmp/u.user’\n\n     0K .......... .......... ..                              100% 78.2K=0.3s\n\n2025-06-17 02:48:48 (78.2 KB/s) - ‘/tmp/u.user’ saved [22628/22628]\n\n--2025-06-17 02:48:48--  http://media.sundog-soft.com/hadoop/ml-100k/u.data\nResolving media.sundog-soft.com (media.sundog-soft.com)... 52.217.131.137, 3.5.8.160, 3.5.1.131, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|52.217.131.137|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 2079229 (2.0M) [application/octet-stream]\nSaving to: ‘/tmp/u.data’\n\n     0K .......... .......... .......... .......... ..........  2% 95.5K 21s\n    50K .......... .......... .......... .......... ..........  4%  232K 14s\n   100K .......... .......... .......... .......... ..........  7%  218K 12s\n   150K .......... .......... .......... .......... ..........  9%  211K 11s\n   200K .......... .......... .......... .......... .......... 12%  224K 10s\n   250K .......... .......... .......... .......... .......... 14%  267K 9s\n   300K .......... .......... .......... .......... .......... 17%  238K 9s\n   350K .......... .......... .......... .......... .......... 19%  334K 8s\n   400K .......... .......... .......... .......... .......... 22%  121K 8s\n   450K .......... .......... .......... .......... .......... 24% 34.7M 7s\n   500K .......... .......... .......... .......... .......... 27%  128K 7s\n   550K .......... .......... .......... .......... .......... 29%  272K 7s\n   600K .......... .......... .......... .......... .......... 32%  279K 7s\n   650K .......... .......... .......... .......... .......... 34%  296K 6s\n   700K .......... .......... .......... .......... .......... 36%  354K 6s\n   750K .......... .......... .......... .......... .......... 39% 61.6K 7s\n   800K .......... .......... .......... .......... .......... 41% 27.9M 6s\n   850K .......... .......... .......... .......... .......... 44% 31.8M 5s\n   900K .......... .......... .......... .......... .......... 46% 26.7M 5s\n   950K .......... .......... .......... .......... .......... 49% 1.34M 4s\n  1000K .......... .......... .......... .......... .......... 51%  348K 4s\n  1050K .......... .......... .......... .......... .......... 54%  279K 4s\n  1100K .......... .......... .......... .......... .......... 56%  431K 4s\n  1150K .......... .......... .......... .......... .......... 59%  350K 3s\n  1200K .......... .......... .......... .......... .......... 61%  356K 3s\n  1250K .......... .......... .......... .......... .......... 64%  407K 3s\n  1300K .......... .......... .......... .......... .......... 66%  413K 3s\n  1350K .......... .......... .......... .......... .......... 68%  403K 2s\n  1400K .......... .......... .......... .......... .......... 71%  435K 2s\n  1450K .......... .......... .......... .......... .......... 73%  391K 2s\n  1500K .......... .......... .......... .......... .......... 76%  403K 2s\n  1550K .......... .......... .......... .......... .......... 78%  329K 2s\n  1600K .......... .......... .......... .......... .......... 81%  351K 1s\n  1650K .......... .......... .......... .......... .......... 83%  386K 1s\n  1700K .......... .......... .......... .......... .......... 86%  305K 1s\n  1750K .......... .......... .......... .......... .......... 88%  326K 1s\n  1800K .......... .......... .......... .......... .......... 91%  307K 1s\n  1850K .......... .......... .......... .......... .......... 93%  337K 0s\n  1900K .......... .......... .......... .......... .......... 96%  343K 0s\n  1950K .......... .......... .......... .......... .......... 98%  381K 0s\n  2000K .......... .......... ..........                      100%  364K=7.2s\n\n2025-06-17 02:48:55 (283 KB/s) - ‘/tmp/u.data’ saved [2079229/2079229]\n\n--2025-06-17 02:48:55--  http://media.sundog-soft.com/hadoop/ml-100k/u.item\nResolving media.sundog-soft.com (media.sundog-soft.com)... 52.216.209.201, 3.5.17.140, 3.5.9.142, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|52.216.209.201|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 236344 (231K) [application/octet-stream]\nSaving to: ‘/tmp/u.item’\n\n     0K .......... .......... .......... .......... .......... 21%  101K 2s\n    50K .......... .......... .......... .......... .......... 43%  360K 1s\n   100K .......... .......... .......... .......... .......... 64%  222K 0s\n   150K .......... .......... .......... .......... .......... 86%  412K 0s\n   200K .......... .......... ..........                      100%  410K=1.1s\n\n2025-06-17 02:48:57 (219 KB/s) - ‘/tmp/u.item’ saved [236344/236344]\n\nDownloaded ml-100k dataset!\n"}]},"apps":[],"jobName":"paragraph_1750128128463_-1381984","id":"20250601-074731_1685467887","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T02:48:44+0000","dateFinished":"2025-06-17T02:48:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13698"},{"text":"%md\n## Remove the directory if already available\n","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Remove the directory if already available</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128463_-1381984","id":"20250601-095954_799972724","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13699"},{"text":"%sh\nhadoop fs -rm -r -f /tmp/ml-100k","user":"anonymous","dateUpdated":"2025-06-17T02:49:02+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"25/06/17 02:49:05 INFO fs.TrashPolicyDefault: Moved: 'hdfs://sandbox-hdp.hortonworks.com:8020/tmp/ml-100k' to trash at: hdfs://sandbox-hdp.hortonworks.com:8020/user/zeppelin/.Trash/Current/tmp/ml-100k1750128545756\n"}]},"apps":[],"jobName":"paragraph_1750128128464_9006236","id":"20250601-081413_440084588","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T02:49:02+0000","dateFinished":"2025-06-17T02:49:06+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13700"},{"text":"%md\n## Create a new directory","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Create a new directory</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128464_9006236","id":"20250601-100007_453821859","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13701"},{"text":"%sh\nhadoop fs -mkdir /tmp/ml-100k/","user":"anonymous","dateUpdated":"2025-06-17T02:49:08+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1750128128464_9006236","id":"20250601-081428_1652930466","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T02:49:08+0000","dateFinished":"2025-06-17T02:49:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13702"},{"text":"%md\n## Put the file from local to the HDFS","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Put the file from local to the HDFS</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128464_9006236","id":"20250601-100023_1989309082","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13703"},{"text":"%sh\nhadoop fs -put /tmp/u.user /tmp/ml-100k/\nhadoop fs -put /tmp/u.data /tmp/ml-100k/\nhadoop fs -put /tmp/u.item /tmp/ml-100k/","user":"anonymous","dateUpdated":"2025-06-17T02:50:16+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1750128128464_9006236","id":"20250601-075032_970300856","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T02:50:16+0000","dateFinished":"2025-06-17T02:50:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13704"},{"text":"%md\n\n# Ensure tables have been created in Cassandra\n\n```{shell}\nCREATE TABLE ratings (\n  user_id int,\n  movieid int,\n  rating int,\n  PRIMARY KEY (user_id, movieid)\n);\n\nCREATE TABLE titles (\n  movieid int PRIMARY KEY,\n  title text,\n  unknown int,\n  action int,\n  adventure int,\n  animation int,\n  children int,\n  comedy int,\n  crime int,\n  documentary int,\n  drama int,\n  fantasy int,\n  filmnoir int,\n  horror int,\n  musical int,\n  mystery int,\n  romance int,\n  scifi int,\n  thriller int,\n  war int,\n  western int\n);\n\nCREATE TABLE users (\n  user_id int, \n  age int, \n  gender text, \n  occupation text, \n  zip text,\nPRIMARY KEY (user_id)\n);\n```","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Ensure tables have been created in Cassandra</h1>\n<pre><code class=\"{shell}\">CREATE TABLE ratings (\n  user_id int,\n  movieid int,\n  rating int,\n  PRIMARY KEY (user_id, movieid)\n);\n\nCREATE TABLE titles (\n  movieid int PRIMARY KEY,\n  title text,\n  unknown int,\n  action int,\n  adventure int,\n  animation int,\n  children int,\n  comedy int,\n  crime int,\n  documentary int,\n  drama int,\n  fantasy int,\n  filmnoir int,\n  horror int,\n  musical int,\n  mystery int,\n  romance int,\n  scifi int,\n  thriller int,\n  war int,\n  western int\n);\n\nCREATE TABLE users (\n  user_id int, \n  age int, \n  gender text, \n  occupation text, \n  zip text,\nPRIMARY KEY (user_id)\n);\n</code></pre>\n"}]},"apps":[],"jobName":"paragraph_1750128128465_8621488","id":"20250616-122251_1937518947","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13705"},{"text":"%md\n## Create RDD for Spark analysis","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Create RDD for Spark analysis</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128465_8621488","id":"20250601-100040_999974092","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13706"},{"text":"%md\n### Create Users RDD and DataFrame","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Create Users RDD and DataFrame</h3>\n"}]},"apps":[],"jobName":"paragraph_1750128128465_8621488","id":"20250601-100334_255312679","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13707"},{"text":"print(spark.version)","user":"anonymous","dateUpdated":"2025-06-17T02:56:16+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2.3.0.2.6.5.0-292"}]},"apps":[],"jobName":"paragraph_1750128128465_8621488","id":"20250616-082512_1958268214","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T02:56:16+0000","dateFinished":"2025-06-17T02:58:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13708"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# ParseInput function\r\ndef parseInput(line):\r\n    fields = line.split('|')\r\n    return Row(user_id=int(fields[0]), age=int(fields[1]), gender=fields[2], occupation=fields[3], zip=fields[4])\r\n\r\n# Load raw user data from HDFS\r\nlines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.user\")\r\n\r\n# Apply transformation\r\nusers = lines.map(parseInput)\r\n\r\n# Create DataFrame\r\nusersDataset = spark.createDataFrame(users)\r\n\r\n# Write to Cassandra\r\nusersDataset.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"users\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadUsers = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"users\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\nreadUsers.show()","user":"anonymous","dateUpdated":"2025-06-17T02:58:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+----------+-----+\n|user_id|age|gender|occupation|  zip|\n+-------+---+------+----------+-----+\n|    636| 47|     M|  educator|48043|\n|    896| 28|     M|    writer|91505|\n|    757| 26|     M|   student|55104|\n|    532| 20|     M|   student|92705|\n|    846| 27|     M|    lawyer|47130|\n|    613| 37|     F| marketing|29678|\n|    690| 35|     M|  salesman|63304|\n|    906| 45|     M| librarian|70124|\n|    566| 20|     M|   student|14627|\n|    488| 48|     M|technician|21012|\n|    150| 20|     F|    artist|02139|\n|    413| 55|     M|  educator|78212|\n|    826| 28|     M|    artist|77048|\n|    281| 15|     F|   student|06059|\n|     85| 51|     M|  educator|20003|\n|    554| 32|     M| scientist|62901|\n|    207| 39|     M| marketing|92037|\n|    100| 36|     M| executive|90254|\n|    502| 22|     M|   student|23092|\n|    464| 60|     M|    writer|94583|\n+-------+---+------+----------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750128128465_8621488","id":"20250601-075141_186696073","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T02:58:24+0000","dateFinished":"2025-06-17T02:59:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13709"},{"text":"%md\n### Create Ratings RDD and DataFrame","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Create Ratings RDD and DataFrame</h3>\n"}]},"apps":[],"jobName":"paragraph_1750128128466_9775734","id":"20250601-100352_1386531563","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13710"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# Parse each line into (user_id, movieid, rating)\r\ndef parseInput2(line):\r\n    fields = line.split('\\t')\r\n    return Row(user_id=int(fields[0]), movieid=int(fields[1]), rating=int(fields[2]))\r\n\r\n# Load ratings data from HDFS\r\nlines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.data\")\r\n\r\n# Map lines to Rows\r\nratings = lines.map(parseInput2)\r\n\r\n# Create DataFrame from ratings\r\nratingsDataset = spark.createDataFrame(ratings)\r\n\r\n# Write to Cassandra\r\nratingsDataset.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"ratings\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadRatings = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"ratings\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\n# Show the result\r\nreadRatings.show()\r\n","user":"anonymous","dateUpdated":"2025-06-17T02:59:57+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------+------+\n|user_id|movieid|rating|\n+-------+-------+------+\n|    636|      1|     3|\n|    636|      9|     3|\n|    636|     10|     5|\n|    636|     15|     5|\n|    636|     25|     5|\n|    636|    100|     5|\n|    636|    106|     4|\n|    636|    118|     5|\n|    636|    121|     5|\n|    636|    222|     5|\n|    636|    235|     4|\n|    636|    258|     5|\n|    636|    272|     5|\n|    636|    275|     3|\n|    636|    283|     3|\n|    636|    313|     5|\n|    636|    596|     5|\n|    636|    740|     4|\n|    636|    760|     5|\n|    636|    813|     5|\n+-------+-------+------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750128128466_9775734","id":"20250601-075951_343576443","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T03:00:12+0000","dateFinished":"2025-06-17T03:00:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13711"},{"text":"%md\n### Create Movie RDD and DataFrame","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Create Movie RDD and DataFrame</h3>\n"}]},"apps":[],"jobName":"paragraph_1750128128466_9775734","id":"20250601-100414_1092910371","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13712"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# Parse movie lines\r\ndef parse_movie(line):\r\n    fields = line.split('|')\r\n    return Row(\r\n        movieid=int(fields[0]),\r\n        title=fields[1],\r\n        unknown=int(fields[5]),\r\n        action=int(fields[6]),\r\n        adventure=int(fields[7]),\r\n        animation=int(fields[8]),\r\n        children=int(fields[9]),\r\n        comedy=int(fields[10]),\r\n        crime=int(fields[11]),\r\n        documentary=int(fields[12]),\r\n        drama=int(fields[13]),\r\n        fantasy=int(fields[14]),\r\n        filmnoir=int(fields[15]),\r\n        horror=int(fields[16]),\r\n        musical=int(fields[17]),\r\n        mystery=int(fields[18]),\r\n        romance=int(fields[19]),\r\n        scifi=int(fields[20]),\r\n        thriller=int(fields[21]),\r\n        war=int(fields[22]),\r\n        western=int(fields[23])\r\n    )\r\n\r\n# Load raw movie data from HDFS\r\nmovie_lines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.item\")\r\n\r\n# Apply parsing\r\nmovies = movie_lines.map(parse_movie)\r\n\r\n# Convert to DataFrame\r\nmovies_df = spark.createDataFrame(movies)\r\n\r\n# Write to Cassandra\r\nmovies_df.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"titles\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadMovies = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"titles\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\n# Show result\r\nreadMovies.show()\r\n","user":"anonymous","dateUpdated":"2025-06-17T03:03:08+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\n|movieid|action|adventure|animation|children|comedy|crime|documentary|drama|fantasy|filmnoir|horror|musical|mystery|romance|scifi|thriller|               title|unknown|war|western|\n+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\n|    636|     1|        1|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    1|       1|Escape from New Y...|      0|  0|      0|\n|   1110|     1|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      1|      0|      0|    1|       0|    Tank Girl (1995)|      0|  0|      0|\n|   1225|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|        Angus (1995)|      0|  0|      0|\n|   1324|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       1|       Loaded (1994)|      0|  0|      0|\n|    896|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Sweet Hereafter, ...|      0|  0|      0|\n|    757|     0|        0|        0|       0|     0|    0|          1|    0|      0|       0|     0|      0|      0|      0|    0|       0|Across the Sea of...|      0|  0|      0|\n|   1117|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Surviving Picasso...|      0|  0|      0|\n|    532|     0|        0|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      1|    0|       0|Kama Sutra: A Tal...|      0|  0|      0|\n|   1080|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|Celestial Clockwo...|      0|  0|      0|\n|    846|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      1|    0|       0|To Gillian on Her...|      0|  0|      0|\n|   1352|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Shadow of Angels ...|      0|  0|      0|\n|    613|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|My Man Godfrey (1...|      0|  0|      0|\n|    690|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Seven Years in Ti...|      0|  1|      0|\n|    906|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      1|    0|       0|Oscar & Lucinda (...|      0|  0|      0|\n|   1335|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|American Buffalo ...|      0|  0|      0|\n|    566|     1|        1|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       1|Clear and Present...|      0|  0|      0|\n|    488|     0|        0|        0|       0|     0|    0|          0|    0|      0|       1|     0|      0|      0|      0|    0|       0| Sunset Blvd. (1950)|      0|  0|      0|\n|   1183|     1|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|Cowboy Way, The (...|      0|  0|      0|\n|    150|     0|        0|        0|       0|     1|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|     Swingers (1996)|      0|  0|      0|\n|    413|     0|        0|        0|       0|     0|    0|          0|    0|      0|       0|     1|      0|      0|      0|    0|       0|Tales from the Cr...|      0|  0|      0|\n+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750128128466_9775734","id":"20250601-080143_442481103","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T03:03:09+0000","dateFinished":"2025-06-17T03:03:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13713"},{"text":"%md\n## 1) Calculate the average rating for each movie.","dateUpdated":"2025-06-17T02:42:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>1) Calculate the average rating for each movie.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128466_9775734","id":"20250601-074655_1233757886","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13714"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.functions import avg\r\n\r\n# Join ratings and movie metadata on movieid\r\njoined_df = readRatings.join(readMovies, on=\"movieid\")\r\n\r\n# Group by title and compute average rating\r\navg_ratings_df = joined_df.groupBy(\"title\").agg(avg(\"rating\").alias(\"avg_rating\"))\r\n\r\n# Order by average rating descending and get top 20\r\ntop_20_movies = avg_ratings_df.orderBy(\"avg_rating\", ascending=False).limit(20)\r\n\r\n# Show the result\r\ntop_20_movies.show()\r\n","user":"anonymous","dateUpdated":"2025-06-17T03:06:40+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----------------+\n|               title|       avg_rating|\n+--------------------+-----------------+\n|Santa with Muscle...|              5.0|\n|Marlene Dietrich:...|              5.0|\n|Someone Else's Am...|              5.0|\n|Aiqing wansui (1994)|              5.0|\n|Saint of Fort Was...|              5.0|\n|     Star Kid (1997)|              5.0|\n|Great Day in Harl...|              5.0|\n|Entertaining Ange...|              5.0|\n|They Made Me a Cr...|              5.0|\n|  Prefontaine (1997)|              5.0|\n|Pather Panchali (...|            4.625|\n|Maya Lin: A Stron...|              4.5|\n|         Anna (1996)|              4.5|\n|      Everest (1998)|              4.5|\n|Some Mother's Son...|              4.5|\n|Close Shave, A (1...|4.491071428571429|\n|Schindler's List ...|4.466442953020135|\n|Wrong Trousers, T...|4.466101694915254|\n|   Casablanca (1942)| 4.45679012345679|\n|Wallace & Gromit:...|4.447761194029851|\n+--------------------+-----------------+\n\n"}]},"apps":[],"jobName":"paragraph_1750128128467_9390985","id":"20250601-075851_486488278","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T03:06:41+0000","dateFinished":"2025-06-17T03:07:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13715"},{"text":"%md\n## 2) Identify the top ten movies with the highest average ratings.","dateUpdated":"2025-06-17T02:42:08+0000","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>2) Identify the top ten movies with the highest average ratings.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128467_9390985","id":"20250601-074714_2026213695","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13716"},{"text":"%pyspark\n\ntop_20_movies.limit(10).show()\n","user":"anonymous","dateUpdated":"2025-06-17T03:09:50+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------+\n|               title|avg_rating|\n+--------------------+----------+\n|Aiqing wansui (1994)|       5.0|\n|They Made Me a Cr...|       5.0|\n|Great Day in Harl...|       5.0|\n|Entertaining Ange...|       5.0|\n|     Star Kid (1997)|       5.0|\n|Someone Else's Am...|       5.0|\n|Marlene Dietrich:...|       5.0|\n|Saint of Fort Was...|       5.0|\n|Santa with Muscle...|       5.0|\n|  Prefontaine (1997)|       5.0|\n+--------------------+----------+\n\n"}]},"apps":[],"jobName":"paragraph_1750128128467_9390985","id":"20250601-084016_851685417","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T03:09:51+0000","dateFinished":"2025-06-17T03:09:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13717"},{"text":"%md\n## 3) Find the users who have rated at least 50 movies and identify their favourite movie genres.","dateUpdated":"2025-06-17T02:42:08+0000","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>3) Find the users who have rated at least 50 movies and identify their favourite movie genres.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128467_9390985","id":"20250601-074750_515576247","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13718"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.functions import col, count, row_number\r\nfrom pyspark.sql.window import Window\r\n\r\n# Filter users who rated at least 50 movies\r\nfiltered_users = readRatings.groupBy(\"user_id\") \\\r\n    .agg(count(\"*\").alias(\"num_ratings\")) \\\r\n    .filter(col(\"num_ratings\") >= 50) \\\r\n    .select(\"user_id\")\r\n\r\n# Join ratings with filtered users and titles\r\nfiltered_ratings = readRatings \\\r\n    .join(filtered_users, on=\"user_id\") \\\r\n    .join(readMovies, on=\"movieid\")\r\n\r\n# Unpivot genre columns\r\ngenre_columns = [\r\n    \"unknown\", \"action\", \"adventure\", \"animation\", \"children\", \"comedy\", \"crime\",\r\n    \"documentary\", \"drama\", \"fantasy\", \"filmNoir\", \"horror\", \"musical\", \"mystery\",\r\n    \"romance\", \"sciFi\", \"thriller\", \"war\", \"western\"\r\n]\r\n\r\n# Flatten genres (manual unpivot via union)\r\nuser_genres = None\r\nfor genre in genre_columns:\r\n    temp = filtered_ratings.filter(col(genre) == 1) \\\r\n        .select(\"user_id\").withColumn(\"genre\", F.lit(genre))\r\n    user_genres = temp if user_genres is None else user_genres.union(temp)\r\n\r\n# Count genre frequencies per user\r\nuser_genre_counts = user_genres.groupBy(\"user_id\", \"genre\") \\\r\n    .agg(count(\"*\").alias(\"count\"))\r\n\r\n# Rank genres per user\r\nwindowSpec = Window.partitionBy(\"user_id\").orderBy(col(\"count\").desc())\r\n\r\nranked_genres = user_genre_counts.withColumn(\"rank\", row_number().over(windowSpec))\r\n\r\n# Select top genre per user\r\ntop_genres_per_user = ranked_genres.filter(col(\"rank\") == 1) \\\r\n    .orderBy(col(\"count\").desc())\r\n\r\ntop_genres_per_user.select(\"user_id\", \"genre\", \"count\").show()\r\n","user":"anonymous","dateUpdated":"2025-06-17T03:10:00+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":true,"setting":{"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"genre","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"genre","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+-----+\n|user_id| genre|count|\n+-------+------+-----+\n|    655| drama|  410|\n|    405| drama|  309|\n|    537| drama|  251|\n|    450| drama|  237|\n|     13| drama|  218|\n|    234| drama|  213|\n|    416| drama|  212|\n|    279|comedy|  211|\n|    201| drama|  196|\n|    393|comedy|  191|\n|    181| drama|  188|\n|    303|comedy|  184|\n|    334| drama|  174|\n|     90| drama|  173|\n|    378| drama|  170|\n|    276| drama|  168|\n|    429| drama|  167|\n|    474| drama|  166|\n|    293| drama|  165|\n|    308| drama|  163|\n+-------+------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750128128467_9390985","id":"20250601-153933_1772289805","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T03:10:00+0000","dateFinished":"2025-06-17T03:11:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13719"},{"text":"%md\n## 4) Find all the users who are less than 20 years old.","dateUpdated":"2025-06-17T02:42:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>4) Find all the users who are less than 20 years old.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128468_7467241","id":"20250601-074805_626279176","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13720"},{"text":"%pyspark\n\nyoung = readUsers.filter(\"age < 20\")\n\nyoung.show()\n","user":"anonymous","dateUpdated":"2025-06-17T03:15:21+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+-------------+-----+\n|user_id|age|gender|   occupation|  zip|\n+-------+---+------+-------------+-----+\n|    281| 15|     F|      student|06059|\n|     36| 19|     F|      student|93117|\n|    347| 18|     M|      student|90210|\n|     68| 19|     M|      student|22904|\n|    341| 17|     F|      student|44405|\n|    179| 15|     M|entertainment|20755|\n|    620| 18|     F|       writer|81648|\n|    863| 17|     M|      student|60089|\n|    904| 17|     F|      student|61073|\n|    291| 19|     M|      student|44106|\n|     57| 16|     M|         none|84010|\n|    609| 13|     F|      student|55106|\n|    621| 17|     M|      student|60402|\n|    887| 14|     F|      student|27249|\n|    270| 18|     F|      student|63119|\n|    761| 17|     M|      student|97302|\n|    258| 19|     F|      student|77801|\n|    367| 17|     M|      student|37411|\n|    206| 14|     F|      student|53115|\n|    142| 13|     M|        other|48118|\n+-------+---+------+-------------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750128128468_7467241","id":"20250601-095246_369636275","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T03:15:21+0000","dateFinished":"2025-06-17T03:15:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13721"},{"text":"%md\n## 5) Find all the users whose occupation is “scientist” and whose age is between 30 and 40 years old.","dateUpdated":"2025-06-17T02:42:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>5) Find all the users whose occupation is “scientist” and whose age is between 30 and 40 years old.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750128128468_7467241","id":"20250601-074819_1245780377","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13722"},{"text":"%pyspark\n\nscientist3040 = readUsers.filter(\n    (col(\"age\") > 29) & (col(\"age\") < 41) & (col(\"occupation\") == \"scientist\"))\n    \nscientist3040.show()","user":"anonymous","dateUpdated":"2025-06-17T03:15:33+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+----------+-----+\n|user_id|age|gender|occupation|  zip|\n+-------+---+------+----------+-----+\n|    554| 32|     M| scientist|62901|\n|     40| 38|     M| scientist|27514|\n|     71| 39|     M| scientist|98034|\n|    874| 36|     M| scientist|37076|\n|    538| 31|     M| scientist|21010|\n|    730| 31|     F| scientist|32114|\n|     74| 39|     M| scientist|T8H1N|\n|    183| 33|     M| scientist|27708|\n|    107| 39|     M| scientist|60466|\n|    918| 40|     M| scientist|70116|\n|    337| 37|     M| scientist|10522|\n|    272| 33|     M| scientist|53706|\n|    430| 38|     M| scientist|98199|\n|    643| 39|     M| scientist|55122|\n|    543| 33|     M| scientist|95123|\n|    309| 40|     M| scientist|70802|\n+-------+---+------+----------+-----+\n\n"}]},"apps":[],"jobName":"paragraph_1750128128468_7467241","id":"20250601-074853_95309685","dateCreated":"2025-06-17T02:42:08+0000","dateStarted":"2025-06-17T03:15:36+0000","dateFinished":"2025-06-17T03:15:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:13723"},{"dateUpdated":"2025-06-17T02:42:08+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1750128128469_7082492","id":"20250601-095645_1372081403","dateCreated":"2025-06-17T02:42:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13724"}],"name":"SQTD6324_Project3_P153146_Final","id":"2KY61FPVC","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}