{"paragraphs":[{"text":"%md\n# This Project aims to explore the `u.user` file from the Movielnes 100k Dataset.","dateUpdated":"2025-06-16T06:35:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>This Project aims to explore the <code>u.user</code> file from the Movielnes 100k Dataset.</h1>\n"}]},"apps":[],"jobName":"paragraph_1750055738216_102585201","id":"20250601-074543_2144772667","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:19704"},{"text":"%md\n## Download the file to a local temp folder","dateUpdated":"2025-06-16T06:35:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Download the file to a local temp folder</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738255_187614708","id":"20250601-095933_900818063","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19705"},{"text":"%sh\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.user -O /tmp/u.user\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.data -O /tmp/u.data\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.item -O /tmp/u.item\necho \"Downloaded ml-100k dataset!\"","user":"anonymous","dateUpdated":"2025-06-16T09:00:15+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2025-06-16 09:00:18--  http://media.sundog-soft.com/hadoop/ml-100k/u.user\nResolving media.sundog-soft.com (media.sundog-soft.com)... 52.217.197.121, 52.217.205.105, 16.182.97.1, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|52.217.197.121|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22628 (22K) [text/plain]\nSaving to: ‘/tmp/u.user’\n\n     0K .......... .......... ..                              100% 86.3K=0.3s\n\n2025-06-16 09:00:18 (86.3 KB/s) - ‘/tmp/u.user’ saved [22628/22628]\n\n--2025-06-16 09:00:18--  http://media.sundog-soft.com/hadoop/ml-100k/u.data\nResolving media.sundog-soft.com (media.sundog-soft.com)... 16.182.70.105, 52.217.133.153, 3.5.7.105, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|16.182.70.105|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 2079229 (2.0M) [application/octet-stream]\nSaving to: ‘/tmp/u.data’\n\n     0K .......... .......... .......... .......... ..........  2% 95.8K 21s\n    50K .......... .......... .......... .......... ..........  4%  288K 13s\n   100K .......... .......... .......... .......... ..........  7%  587K 10s\n   150K .......... .......... .......... .......... ..........  9%  352M 7s\n   200K .......... .......... .......... .......... .......... 12%  196K 7s\n   250K .......... .......... .......... .......... .......... 14% 22.9M 6s\n   300K .......... .......... .......... .......... .......... 17%  291K 6s\n   350K .......... .......... .......... .......... .......... 19%  632K 5s\n   400K .......... .......... .......... .......... .......... 22% 3.06M 5s\n   450K .......... .......... .......... .......... .......... 24%  361M 4s\n   500K .......... .......... .......... .......... .......... 27%  676M 4s\n   550K .......... .......... .......... .......... .......... 29%  597M 3s\n   600K .......... .......... .......... .......... .......... 32%  714M 3s\n   650K .......... .......... .......... .......... .......... 34%  308K 3s\n   700K .......... .......... .......... .......... .......... 36% 22.9M 3s\n   750K .......... .......... .......... .......... .......... 39% 41.2M 2s\n   800K .......... .......... .......... .......... .......... 41%  646K 2s\n   850K .......... .......... .......... .......... .......... 44% 5.57M 2s\n   900K .......... .......... .......... .......... .......... 46% 7.27M 2s\n   950K .......... .......... .......... .......... .......... 49%  166M 2s\n  1000K .......... .......... .......... .......... .......... 51% 17.0M 1s\n  1050K .......... .......... .......... .......... .......... 54% 46.4M 1s\n  1100K .......... .......... .......... .......... .......... 56% 14.2M 1s\n  1150K .......... .......... .......... .......... .......... 59% 25.5M 1s\n  1200K .......... .......... .......... .......... .......... 61% 16.1M 1s\n  1250K .......... .......... .......... .......... .......... 64% 28.3M 1s\n  1300K .......... .......... .......... .......... .......... 66% 22.0M 1s\n  1350K .......... .......... .......... .......... .......... 68%  353K 1s\n  1400K .......... .......... .......... .......... .......... 71% 8.23M 1s\n  1450K .......... .......... .......... .......... .......... 73%  356M 1s\n  1500K .......... .......... .......... .......... .......... 76% 10.1M 1s\n  1550K .......... .......... .......... .......... .......... 78% 58.7M 0s\n  1600K .......... .......... .......... .......... .......... 81%  697K 0s\n  1650K .......... .......... .......... .......... .......... 83%  406M 0s\n  1700K .......... .......... .......... .......... .......... 86%  194M 0s\n  1750K .......... .......... .......... .......... .......... 88% 6.50M 0s\n  1800K .......... .......... .......... .......... .......... 91% 11.6M 0s\n  1850K .......... .......... .......... .......... .......... 93%  481M 0s\n  1900K .......... .......... .......... .......... .......... 96% 16.4M 0s\n  1950K .......... .......... .......... .......... .......... 98% 17.4M 0s\n  2000K .......... .......... ..........                      100% 4.07M=1.8s\n\n2025-06-16 09:00:21 (1.08 MB/s) - ‘/tmp/u.data’ saved [2079229/2079229]\n\n--2025-06-16 09:00:21--  http://media.sundog-soft.com/hadoop/ml-100k/u.item\nResolving media.sundog-soft.com (media.sundog-soft.com)... 54.231.166.201, 52.217.90.84, 52.217.138.57, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|54.231.166.201|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 236344 (231K) [application/octet-stream]\nSaving to: ‘/tmp/u.item’\n\n     0K .......... .......... .......... .......... .......... 21% 99.7K 2s\n    50K .......... .......... .......... .......... .......... 43%  288K 1s\n   100K .......... .......... .......... .......... .......... 64%  630K 0s\n   150K .......... .......... .......... .......... .......... 86% 4.35M 0s\n   200K .......... .......... ..........                      100%  129K=1.0s\n\n2025-06-16 09:00:23 (230 KB/s) - ‘/tmp/u.item’ saved [236344/236344]\n\nDownloaded ml-100k dataset!\n"}]},"apps":[],"jobName":"paragraph_1750055738270_194155440","id":"20250601-074731_1685467887","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T09:00:17+0000","dateFinished":"2025-06-16T09:00:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19706"},{"text":"%md\n## Remove the directory if already available\n","dateUpdated":"2025-06-16T06:35:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Remove the directory if already available</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738270_194155440","id":"20250601-095954_799972724","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19707"},{"text":"%sh\nhadoop fs -rm -r -f /tmp/ml-100k","dateUpdated":"2025-06-16T06:35:38+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"25/06/01 08:14:23 INFO fs.TrashPolicyDefault: Moved: 'hdfs://sandbox-hdp.hortonworks.com:8020/tmp/ml-100k' to trash at: hdfs://sandbox-hdp.hortonworks.com:8020/user/zeppelin/.Trash/Current/tmp/ml-100k1748765663808\n"}]},"apps":[],"jobName":"paragraph_1750055738270_194155440","id":"20250601-081413_440084588","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19708"},{"text":"%md\n## Create a new directory","dateUpdated":"2025-06-16T06:35:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Create a new directory</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738271_193770691","id":"20250601-100007_453821859","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19709"},{"text":"%sh\nhadoop fs -mkdir /tmp/ml-100k/","dateUpdated":"2025-06-16T06:35:38+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"mkdir: `/tmp/ml-100k': File exists\n"},{"type":"TEXT","data":"ExitValue: 1"}]},"apps":[],"jobName":"paragraph_1750055738271_193770691","id":"20250601-081428_1652930466","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19710"},{"text":"%md\n## Put the file from local to the HDFS","dateUpdated":"2025-06-16T06:35:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Put the file from local to the HDFS</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738272_179534981","id":"20250601-100023_1989309082","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19711"},{"text":"%sh\nhadoop fs -put /tmp/u.user /tmp/ml-100k/\nhadoop fs -put /tmp/u.data /tmp/ml-100k/\nhadoop fs -put /tmp/u.item /tmp/ml-100k/","dateUpdated":"2025-06-16T06:35:38+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1750055738272_179534981","id":"20250601-075032_970300856","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19712"},{"text":"%md\n\n# Ensure tables have been created in Cassandra\n\n```{shell}\nCREATE TABLE ratings (\n  user_id int,\n  movieid int,\n  rating int,\n  PRIMARY KEY (user_id, movieid)\n);\n\nCREATE TABLE titles (\n  movieid int PRIMARY KEY,\n  title text,\n  unknown int,\n  action int,\n  adventure int,\n  animation int,\n  children int,\n  comedy int,\n  crime int,\n  documentary int,\n  drama int,\n  fantasy int,\n  filmnoir int,\n  horror int,\n  musical int,\n  mystery int,\n  romance int,\n  scifi int,\n  thriller int,\n  war int,\n  western int\n);\n\nCREATE TABLE users (\n  user_id int, \n  age int, \n  gender text, \n  occupation text, \n  zip text,\nPRIMARY KEY (user_id)\n);\n```","user":"anonymous","dateUpdated":"2025-06-16T13:27:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Ensure tables have been created in Cassandra</h1>\n<pre><code class=\"{shell}\">CREATE TABLE ratings (\n  user_id int,\n  movieid int,\n  rating int,\n  PRIMARY KEY (user_id, movieid)\n);\n\nCREATE TABLE titles (\n  movieid int PRIMARY KEY,\n  title text,\n  unknown int,\n  action int,\n  adventure int,\n  animation int,\n  children int,\n  comedy int,\n  crime int,\n  documentary int,\n  drama int,\n  fantasy int,\n  filmnoir int,\n  horror int,\n  musical int,\n  mystery int,\n  romance int,\n  scifi int,\n  thriller int,\n  war int,\n  western int\n);\n\nCREATE TABLE users (\n  user_id int, \n  age int, \n  gender text, \n  occupation text, \n  zip text,\nPRIMARY KEY (user_id)\n);\n</code></pre>\n"}]},"apps":[],"jobName":"paragraph_1750076571946_1186054558","id":"20250616-122251_1937518947","dateCreated":"2025-06-16T12:22:51+0000","dateStarted":"2025-06-16T13:27:19+0000","dateFinished":"2025-06-16T13:27:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19713"},{"text":"%md\n## Create RDD for Spark analysis","user":"anonymous","dateUpdated":"2025-06-16T12:24:11+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Create RDD for Spark analysis</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738272_179534981","id":"20250601-100040_999974092","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T12:24:11+0000","dateFinished":"2025-06-16T12:24:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19715"},{"text":"%md\n### Create Users RDD and DataFrame","user":"anonymous","dateUpdated":"2025-06-16T09:00:34+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Create Users RDD and DataFrame</h3>\n"}]},"apps":[],"jobName":"paragraph_1750055738273_179150233","id":"20250601-100334_255312679","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T09:00:34+0000","dateFinished":"2025-06-16T09:00:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19716"},{"text":"print(spark.version)","user":"anonymous","dateUpdated":"2025-06-16T13:27:57+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2.3.0.2.6.5.0-292"}]},"apps":[],"jobName":"paragraph_1750062312978_1165838451","id":"20250616-082512_1958268214","dateCreated":"2025-06-16T08:25:12+0000","dateStarted":"2025-06-16T09:42:56+0000","dateFinished":"2025-06-16T09:42:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19717"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# ParseInput function\r\ndef parseInput(line):\r\n    fields = line.split('|')\r\n    return Row(user_id=int(fields[0]), age=int(fields[1]), gender=fields[2], occupation=fields[3], zip=fields[4])\r\n\r\n# Load raw user data from HDFS\r\nlines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.user\")\r\n\r\n# Apply transformation\r\nusers = lines.map(parseInput)\r\n\r\n# Create DataFrame\r\nusersDataset = spark.createDataFrame(users)\r\n\r\n# Write to Cassandra\r\nusersDataset.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"users\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadUsers = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"users\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\nreadUsers.show()","user":"anonymous","dateUpdated":"2025-06-16T13:28:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+-------------+-----+\n|user_id|age|gender|   occupation|  zip|\n+-------+---+------+-------------+-----+\n|    660| 26|     M|      student|77380|\n|    893| 25|     M|      student|95823|\n|     53| 26|     M|   programmer|55414|\n|    878| 50|     F|     educator|98027|\n|    110| 19|     M|      student|77840|\n|     91| 55|     M|    marketing|01913|\n|    128| 24|     F|    marketing|20009|\n|    363| 20|     M|      student|87501|\n|    251| 28|     M|       doctor|85032|\n|    744| 35|     M|    marketing|47024|\n|    778| 34|     M|      student|01960|\n|    819| 59|     M|administrator|40205|\n|    310| 37|     M|     educator|91711|\n|    849| 15|     F|      student|25652|\n|    247| 28|     M|     engineer|20770|\n|    796| 32|     F|       writer|33755|\n|    919| 25|     M|        other|14216|\n|    214| 26|     F|    librarian|11231|\n|    429| 27|     M|      student|29205|\n|    117| 20|     M|      student|16125|\n+-------+---+------+-------------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750055738273_179150233","id":"20250601-075141_186696073","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T10:56:01+0000","dateFinished":"2025-06-16T10:56:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19718"},{"text":"%md\n### Create Ratings RDD and DataFrame","dateUpdated":"2025-06-16T06:35:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Create Ratings RDD and DataFrame</h3>\n"}]},"apps":[],"jobName":"paragraph_1750055738273_179150233","id":"20250601-100352_1386531563","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19719"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# Parse each line into (user_id, movieid, rating)\r\ndef parseInput2(line):\r\n    fields = line.split('\\t')\r\n    return Row(user_id=int(fields[0]), movieid=int(fields[1]), rating=int(fields[2]))\r\n\r\n# Load ratings data from HDFS\r\nlines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.data\")\r\n\r\n# Map lines to Rows\r\nratings = lines.map(parseInput2)\r\n\r\n# Create DataFrame from ratings\r\nratingsDataset = spark.createDataFrame(ratings)\r\n\r\n# Write to Cassandra\r\nratingsDataset.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"ratings\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadRatings = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"ratings\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\n# Show the result\r\nreadRatings.show()\r\n","user":"anonymous","dateUpdated":"2025-06-16T10:42:06+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------+------+\n|user_id|movieid|rating|\n+-------+-------+------+\n|    660|      1|     3|\n|    660|      2|     2|\n|    660|      3|     1|\n|    660|      7|     3|\n|    660|      8|     2|\n|    660|     17|     1|\n|    660|     21|     3|\n|    660|     22|     4|\n|    660|     24|     3|\n|    660|     29|     2|\n|    660|     33|     2|\n|    660|     38|     2|\n|    660|     40|     2|\n|    660|     41|     1|\n|    660|     47|     2|\n|    660|     50|     4|\n|    660|     56|     1|\n|    660|     62|     2|\n|    660|     63|     2|\n|    660|     64|     3|\n+-------+-------+------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750055738274_180304479","id":"20250601-075951_343576443","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T10:42:52+0000","dateFinished":"2025-06-16T10:53:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19720"},{"text":"%md\n### Create Movie RDD and DataFrame","dateUpdated":"2025-06-16T06:35:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Create Movie RDD and DataFrame</h3>\n"}]},"apps":[],"jobName":"paragraph_1750055738274_180304479","id":"20250601-100414_1092910371","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19721"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# Parse movie lines\r\ndef parse_movie(line):\r\n    fields = line.split('|')\r\n    return Row(\r\n        movieid=int(fields[0]),\r\n        title=fields[1],\r\n        unknown=int(fields[5]),\r\n        action=int(fields[6]),\r\n        adventure=int(fields[7]),\r\n        animation=int(fields[8]),\r\n        children=int(fields[9]),\r\n        comedy=int(fields[10]),\r\n        crime=int(fields[11]),\r\n        documentary=int(fields[12]),\r\n        drama=int(fields[13]),\r\n        fantasy=int(fields[14]),\r\n        filmnoir=int(fields[15]),\r\n        horror=int(fields[16]),\r\n        musical=int(fields[17]),\r\n        mystery=int(fields[18]),\r\n        romance=int(fields[19]),\r\n        scifi=int(fields[20]),\r\n        thriller=int(fields[21]),\r\n        war=int(fields[22]),\r\n        western=int(fields[23])\r\n    )\r\n\r\n# Load raw movie data from HDFS\r\nmovie_lines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.item\")\r\n\r\n# Apply parsing\r\nmovies = movie_lines.map(parse_movie)\r\n\r\n# Convert to DataFrame\r\nmovies_df = spark.createDataFrame(movies)\r\n\r\n# Write to Cassandra\r\nmovies_df.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"titles\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadMovies = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"titles\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\n# Show result\r\nreadMovies.show()\r\n","user":"anonymous","dateUpdated":"2025-06-16T11:38:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\n|movieid|action|adventure|animation|children|comedy|crime|documentary|drama|fantasy|filmnoir|horror|musical|mystery|romance|scifi|thriller|               title|unknown|war|western|\n+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\n|   1548|     1|        0|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       1|The Courtyard (1995)|      0|  0|      0|\n|    660|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Fried Green Tomat...|      0|  0|      0|\n|    893|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|For Richer or Poo...|      0|  0|      0|\n|   1193|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Before the Rain (...|      0|  0|      0|\n|     53|     1|        0|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       1|Natural Born Kill...|      0|  0|      0|\n|    987|     0|        0|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       1|   Underworld (1997)|      0|  0|      0|\n|    878|     0|        0|        0|       1|     1|    0|          0|    0|      0|       0|     0|      0|      1|      0|    0|       0|That Darn Cat! (1...|      0|  0|      0|\n|    110|     1|        1|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|Operation Dumbo D...|      0|  1|      0|\n|     91|     0|        0|        0|       1|     1|    0|          0|    0|      0|       0|     0|      1|      0|      0|    0|       0|Nightmare Before ...|      0|  0|      0|\n|    128|     1|        0|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       1|     Supercop (1992)|      0|  0|      0|\n|    363|     1|        0|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0| Sudden Death (1995)|      0|  0|      0|\n|   1425|     0|        0|        0|       0|     1|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|I'll Do Anything ...|      0|  0|      0|\n|    251|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|Shall We Dance? (...|      0|  0|      0|\n|    744|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Michael Collins (...|      0|  1|      0|\n|   1052|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     1|      0|      0|      0|    0|       0|Dracula: Dead and...|      0|  0|      0|\n|    778|     0|        0|        0|       0|     1|    0|          0|    1|      0|       0|     0|      0|      0|      1|    0|       0|Don Juan DeMarco ...|      0|  0|      0|\n|    819|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|        Eddie (1996)|      0|  0|      0|\n|    310|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Rainmaker, The (1...|      0|  0|      0|\n|    849|     1|        0|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      1|    0|       0|Days of Thunder (...|      0|  0|      0|\n|    247|     1|        1|        0|       1|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|Turbo: A Power Ra...|      0|  0|      0|\n+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750055738274_180304479","id":"20250601-080143_442481103","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T11:06:07+0000","dateFinished":"2025-06-16T11:08:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19722"},{"text":"%md\n## 1) Calculate the average rating for each movie.","dateUpdated":"2025-06-16T06:35:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>1) Calculate the average rating for each movie.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738275_179919730","id":"20250601-074655_1233757886","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19723"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.functions import avg\r\n\r\n# Join ratings and movie metadata on movieid\r\njoined_df = readRatings.join(readMovies, on=\"movieid\")\r\n\r\n# Group by title and compute average rating\r\navg_ratings_df = joined_df.groupBy(\"title\").agg(avg(\"rating\").alias(\"avg_rating\"))\r\n\r\n# Order by average rating descending and get top 20\r\ntop_20_movies = avg_ratings_df.orderBy(\"avg_rating\", ascending=False).limit(20)\r\n\r\n# Show the result\r\ntop_20_movies.show()\r\n","user":"anonymous","dateUpdated":"2025-06-16T11:19:15+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----------------+\n|               title|       avg_rating|\n+--------------------+-----------------+\n|Aiqing wansui (1994)|              5.0|\n|Someone Else's Am...|              5.0|\n|Saint of Fort Was...|              5.0|\n|Marlene Dietrich:...|              5.0|\n|     Star Kid (1997)|              5.0|\n|Great Day in Harl...|              5.0|\n|Entertaining Ange...|              5.0|\n|They Made Me a Cr...|              5.0|\n|Santa with Muscle...|              5.0|\n|  Prefontaine (1997)|              5.0|\n|Pather Panchali (...|            4.625|\n|         Anna (1996)|              4.5|\n|      Everest (1998)|              4.5|\n|Maya Lin: A Stron...|              4.5|\n|Some Mother's Son...|              4.5|\n|Close Shave, A (1...|4.491071428571429|\n|Schindler's List ...|4.466442953020135|\n|Wrong Trousers, T...|4.466101694915254|\n|   Casablanca (1942)| 4.45679012345679|\n|Wallace & Gromit:...|4.447761194029851|\n+--------------------+-----------------+\n\n"}]},"apps":[],"jobName":"paragraph_1750055738275_179919730","id":"20250601-075851_486488278","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T11:19:15+0000","dateFinished":"2025-06-16T11:25:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19724"},{"text":"%md\n## 2) Identify the top ten movies with the highest average ratings.","dateUpdated":"2025-06-16T06:35:38+0000","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>2) Identify the top ten movies with the highest average ratings.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738276_177995986","id":"20250601-074714_2026213695","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19725"},{"text":"%pyspark\n\ntop_20_movies.limit(10).show()\n","user":"anonymous","dateUpdated":"2025-06-16T11:36:13+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------+\n|               title|avg_rating|\n+--------------------+----------+\n|Marlene Dietrich:...|       5.0|\n|Someone Else's Am...|       5.0|\n|Aiqing wansui (1994)|       5.0|\n|Great Day in Harl...|       5.0|\n|Saint of Fort Was...|       5.0|\n|     Star Kid (1997)|       5.0|\n|Entertaining Ange...|       5.0|\n|They Made Me a Cr...|       5.0|\n|Santa with Muscle...|       5.0|\n|  Prefontaine (1997)|       5.0|\n+--------------------+----------+\n\n"}]},"apps":[],"jobName":"paragraph_1750055738276_177995986","id":"20250601-084016_851685417","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T11:36:30+0000","dateFinished":"2025-06-16T11:39:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19726"},{"text":"%md\n## 3) Find the users who have rated at least 50 movies and identify their favourite movie genres.","dateUpdated":"2025-06-16T06:35:38+0000","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>3) Find the users who have rated at least 50 movies and identify their favourite movie genres.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738276_177995986","id":"20250601-074750_515576247","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19727"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.functions import col, count, row_number\r\nfrom pyspark.sql.window import Window\r\n\r\n# Filter users who rated at least 50 movies\r\nfiltered_users = readRatings.groupBy(\"user_id\") \\\r\n    .agg(count(\"*\").alias(\"num_ratings\")) \\\r\n    .filter(col(\"num_ratings\") >= 50) \\\r\n    .select(\"user_id\")\r\n\r\n# Join ratings with filtered users and titles\r\nfiltered_ratings = readRatings \\\r\n    .join(filtered_users, on=\"user_id\") \\\r\n    .join(readMovies, on=\"movieid\")\r\n\r\n# Unpivot genre columns\r\ngenre_columns = [\r\n    \"unknown\", \"action\", \"adventure\", \"animation\", \"children\", \"comedy\", \"crime\",\r\n    \"documentary\", \"drama\", \"fantasy\", \"filmNoir\", \"horror\", \"musical\", \"mystery\",\r\n    \"romance\", \"sciFi\", \"thriller\", \"war\", \"western\"\r\n]\r\n\r\n# Flatten genres (manual unpivot via union)\r\nuser_genres = None\r\nfor genre in genre_columns:\r\n    temp = filtered_ratings.filter(col(genre) == 1) \\\r\n        .select(\"user_id\").withColumn(\"genre\", F.lit(genre))\r\n    user_genres = temp if user_genres is None else user_genres.union(temp)\r\n\r\n# Count genre frequencies per user\r\nuser_genre_counts = user_genres.groupBy(\"user_id\", \"genre\") \\\r\n    .agg(count(\"*\").alias(\"count\"))\r\n\r\n# Rank genres per user\r\nwindowSpec = Window.partitionBy(\"user_id\").orderBy(col(\"count\").desc())\r\n\r\nranked_genres = user_genre_counts.withColumn(\"rank\", row_number().over(windowSpec))\r\n\r\n# Select top genre per user\r\ntop_genres_per_user = ranked_genres.filter(col(\"rank\") == 1) \\\r\n    .orderBy(col(\"count\").desc())\r\n\r\ntop_genres_per_user.select(\"user_id\", \"genre\", \"count\").show()\r\n","user":"anonymous","dateUpdated":"2025-06-16T13:28:25+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":true,"setting":{"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"genre","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"genre","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+-----+\n|user_id| genre|count|\n+-------+------+-----+\n|    655| drama|  410|\n|    405| drama|  309|\n|    537| drama|  251|\n|    450| drama|  237|\n|     13| drama|  218|\n|    234| drama|  213|\n|    416| drama|  212|\n|    279|comedy|  211|\n|    201| drama|  196|\n|    393|comedy|  191|\n|    181| drama|  188|\n|    303|comedy|  184|\n|    334| drama|  174|\n|     90| drama|  173|\n|    378| drama|  170|\n|    276| drama|  168|\n|    429| drama|  167|\n|    474| drama|  166|\n|    293| drama|  165|\n|    308| drama|  163|\n+-------+------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750055738276_177995986","id":"20250601-153933_1772289805","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T11:41:53+0000","dateFinished":"2025-06-16T12:02:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19728"},{"text":"%md\n## 4) Find all the users who are less than 20 years old.","dateUpdated":"2025-06-16T06:35:38+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>4) Find all the users who are less than 20 years old.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738277_177611237","id":"20250601-074805_626279176","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19729"},{"text":"%pyspark\n\nyoung = readUsers.filter(\"age < 20\")\n\nyoung.show()\n","user":"anonymous","dateUpdated":"2025-06-16T12:12:55+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+-------------+-----+\n|user_id|age|gender|   occupation|  zip|\n+-------+---+------+-------------+-----+\n|    110| 19|     M|      student|77840|\n|    849| 15|     F|      student|25652|\n|    729| 19|     M|      student|56567|\n|    631| 18|     F|      student|38866|\n|    787| 18|     F|      student|98620|\n|    646| 17|     F|      student|51250|\n|    925| 18|     F|     salesman|49036|\n|    619| 17|     M|      student|44134|\n|    320| 19|     M|      student|24060|\n|    461| 15|     M|      student|98102|\n|     67| 17|     M|      student|60402|\n|    281| 15|     F|      student|06059|\n|     36| 19|     F|      student|93117|\n|    347| 18|     M|      student|90210|\n|     68| 19|     M|      student|22904|\n|    341| 17|     F|      student|44405|\n|    179| 15|     M|entertainment|20755|\n|    620| 18|     F|       writer|81648|\n|    863| 17|     M|      student|60089|\n|    904| 17|     F|      student|61073|\n+-------+---+------+-------------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1750055738277_177611237","id":"20250601-095246_369636275","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T12:12:55+0000","dateFinished":"2025-06-16T12:16:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19730"},{"text":"%md\n## 5) Find all the users whose occupation is “scientist” and whose age is between 30 and 40 years old.","dateUpdated":"2025-06-16T06:35:38+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>5) Find all the users whose occupation is “scientist” and whose age is between 30 and 40 years old.</h2>\n"}]},"apps":[],"jobName":"paragraph_1750055738277_177611237","id":"20250601-074819_1245780377","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19731"},{"text":"%pyspark\n\nscientist3040 = readUsers.filter(\n    (col(\"age\") > 30) & (col(\"age\") < 40) & (col(\"occupation\") == \"scientist\"))\n    \nscientist3040.show()","user":"anonymous","dateUpdated":"2025-06-16T12:19:08+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+----------+-----+\n|user_id|age|gender|occupation|  zip|\n+-------+---+------+----------+-----+\n|    874| 36|     M| scientist|37076|\n|    538| 31|     M| scientist|21010|\n|    554| 32|     M| scientist|62901|\n|     40| 38|     M| scientist|27514|\n|     71| 39|     M| scientist|98034|\n|    272| 33|     M| scientist|53706|\n|    430| 38|     M| scientist|98199|\n|    643| 39|     M| scientist|55122|\n|    543| 33|     M| scientist|95123|\n|    183| 33|     M| scientist|27708|\n|    107| 39|     M| scientist|60466|\n|    337| 37|     M| scientist|10522|\n|    730| 31|     F| scientist|32114|\n|     74| 39|     M| scientist|T8H1N|\n+-------+---+------+----------+-----+\n\n"}]},"apps":[],"jobName":"paragraph_1750055738278_178765484","id":"20250601-074853_95309685","dateCreated":"2025-06-16T06:35:38+0000","dateStarted":"2025-06-16T12:19:08+0000","dateFinished":"2025-06-16T12:20:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:19732"},{"dateUpdated":"2025-06-16T06:35:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1750055738278_178765484","id":"20250601-095645_1372081403","dateCreated":"2025-06-16T06:35:38+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:19733"}],"name":"SQTD6324_Project3_P153146_Final","id":"2KZ49DQ9N","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}